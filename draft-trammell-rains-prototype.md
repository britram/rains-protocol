----
title: RAINS, Another Internet Naming Service: Protocol Specification
abbrev: RAINS
docname: draft-trammell-rains-protocol
date: 
category: info

ipr: trust200902
area: Internet Architecture Board
workgroup: Names and Identifiers Program
keyword: Internet-Draft

stand_alone: yes
pi: [toc, sortrefs, symrefs]

author:
 -
    ins: B. Trammell
    name: Brian Trammell
    organization: ETH Zurich, Network Security Group
    street: Universitaetstrasse 6
    city: Zurich
    code: 8092
    country: Switzerland
    email: ietf@trammell.ch

normative:
    draft-trammell-inip-pins:
    RFC7049:

informative:
    RFC1035:

--- abstract

This document describes an alternate protocol for Internet name resolution, designed as a prototype to facilitate conversation about the evolution or replacement of the Domain Name System protocol.

--- middle

# Introduction

# Terminology

- assertion

- authority

- querier

- context

# Architecture

The RAINS architecture is simple, and resembles the architecture of DNS. A
RAINS Server is an entity that provides transient and/or permanent storage for
assertions about names, and a lookup function that finds assertions for a
given query about a name, either by searching local storage or by delegating
to another RAINS server. RAINS servers can take on any or all of three roles:

- authority service, acting on behalf of an authority to ensure properly
  signed assertions are made available to the system (equivalent to an
  authoritative server in DNS);
- query service, acting on behalf of a client to answer queries with relevant
  assertions (equivalent to a recursive resolver in DNS), and to validate
  assertions on the client's behalf; and/or
- intermediary service, acting on behalf of neither but providing storage and
  lookup for assertions with certain properties for query and authority
  servers (partially replacing, but not really equivalent to, caching
  resolvers in DNS).

RAINS Servers use the RAINS Protocol defined in this document to exchange
queries and assertions. RAINS clients use a subset variant of the RAINS Protocol
(called the RAINS Client Protocol) to interact with RAINS Servers providing
query services on their behalf.

# Information Model

Messages in the RAINS Protocol are made up of three kinds of elements:
Assertion, Query, and Notification. A fourth type of element, Answer, binds a
Query to a set of Assertions in response to a Query.

## Assertion

An Assertion is a signed statement about a mapping from a subject name to an
object value, and consists of the following elements:

- Context: name of the context in which the assertion is valid;
  see {{context-in-assertions}} below.
- Subject: name about which the assertion is made. The subject name is 
  always fully qualified, containing all of the elements of the name back 
  to the root.)
- Type: the type of information about the Subject contained in the 
  assertion. Each Assertion is about a single type of data.
- Object: the data of the indicated type associated with the Subject
- Signatures: one or more signatures generated by the authority for the
  Assertion, covering all elements of the Assertion except the signature
  itself. Signatures contain a time interval during which they are considered
  valid, and may contain a revocation token allowing them to be revoked before
  the end of the time interval. See {{signatures-in-assertions}} below.

The Types supported for each assertion are:

- Delegation: the authority associated with the zone identified by the name
  (roughly equivalent to the DNSSEC DS RRTYPE). The Object contains a public
  key by which the authority can be identified.
- Redirection: The name(s) of one or more a RAINS servers providing authority
  service for the authority associated with the zone (roughly equivalent to
  the DNSSEC NS RRTYPE, but not always consulted directly during resolution).
  The Object contains a set of names.
- Address: one or more addresses associated with the name (replaces DNS A and
  AAAA RTYPEs). The Object contains a set of Addresses. An Address is an 
  {address-family, value} tuple.
- Service-Info: one or more layer 4 ports and hostnames associated with a
  service name (replaces DNS SRV RRTYPE). The object contains a {hostname,
  port-number, priority tuple}.
- Name: one or more names associated with the name (roughly equivalent to DNS
  CNAME). The Object contains a set of names.
- Certificate: a certificate which must appear at a specified location in the
  certificate chain presented on a connection attempt with the named entity
  (roughly equivalent to DNS TLSA).

For a given {subject, type} tuple, multiple assertions can be valid at a given point in time; the union of the object values is considered

### Context in Assertions

Assertion contexts are used to determine the validity of the signature by the
declared authority as follows:

- The global context is identified by the special context name `.'. Assertions
  in the global context are signed by the authority for the subject name. For
  example, assertions about the name simplon.inf.ethz.ch in the global context
  are only valid if signed by the relevant authority inf.ethz.ch.
- A local context is associated with a given authority. The authority-part and
  the context-part of a local context name are divided by a context marker 
  ('--cx-'). The authority-part directly identifies the authority whose key was
  used to sign the assertion; assertions within a local context are only valid
  if signed by the identified authority. Authorities have complete control
  over how the contexts under their namespaces are arranged. For example,
  ethz.ch could create one context for each of its departments, and sign
  assertions about simplon.local within the inf.--cx-.ethz.ch context; starbucks.com could 

Assertion context is the mechanism by which RAINS provides explicit
inconsistency (see section 5.3.2 of {{I-D.trammell-inip-pins}}). 

### Signatures in Assertions

A signature over an assertion 

### Shards and Zones

TODO

## Query

A query is a request for a set of assertions supporting a conclusion about a given subject-object mapping. It consists of the following information elements:

- contexts: a set of names of contexts in which responses will be accepted. A query may also name a special “any” context, signifying a willingness to receive information about names in any context available at the oracle. (actually, need finer-grained context selection than this...)
- subject: the name about which the query is made
- types: a list of the types of information about the subject the query requests.
- token: an optional identifier generated by the querier, which will be echoed back in the answer

### Context in Queries

## Answer

(here's a query, and all the assertions we found for it)

(how to authenticate nonexistence? porting nsec3 to rains...)

(other special answers?)

## Notification

(including error messages)

# Data Model

The RAINS data model is a relatively straightforward mapping of the
information model above to the Concise Binary Object Representation (CBOR)
{{RFC7049}}, with an outer message type providing a mechanism for future
capabilities-based versioning and recognition of a message as a RAINS message. Each CBOR object in a RAINS message is implemented as a map of integer keys to values, in order to provide a tradeoff between efficiency of representation and flexibility.

note use the key U+96A8 for versioning in messages.

# Protocol Definition

## RAINS Client Protocol

# Deployment Considerations

## Translation between RAINS and DNS

## Client Resolver Programming Interface

## Authority Signer/Server Interface

# IANA Considerations

# Security Considerations

# Acknowledgments


